    <head>
      <link rel="stylesheet" href="track-form.css">

    </head>
    <div class="max-w-4xl mx-auto animate-slide-up">
      <!-- Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-white">
          {{ isEditMode ? 'Edit Track' : 'Add New Track' }}
        </h1>
        <p class="text-white mt-2">
          {{ isEditMode 
            ? 'Update the details of your track.' 
            : 'Fill in the details to add a new track to your library.' }}
        </p>
      </div>

      <form [formGroup]="trackForm" (ngSubmit)="onSubmit()" class="space-y-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Left Column: Basic Info -->
          <div class="lg:col-span-2 space-y-6">
            <!-- Basic Information Card -->
            <div class="card">
              <h3 class="text-xl font-bold text-white mb-6 pb-4 border-b border-gray-100">
                <i class="fas fa-info-circle text-primary-600 mr-2"></i>
                Basic Information
              </h3>
              
              <div class="space-y-6">
                <!-- Title -->
                <div>
                  <label for="title" class="block text-sm font-medium text-white mb-2">
                    Track Title *
                  </label>
                  <input id="title"
                         type="text"
                         formControlName="title"
                         placeholder="Enter track title"
                         class="input"
                         [class.border-red-500]="isFieldInvalid('title')" />
                  <div *ngIf="isFieldInvalid('title')" class="mt-2 text-sm text-red-600">
                    <span *ngIf="trackForm.get('title')?.errors?.['required']">Title is required</span>
                    <span *ngIf="trackForm.get('title')?.errors?.['maxlength']">Title cannot exceed 50 characters</span>
                  </div>
                  <div class="mt-1 text-xs text-gray-500">
                    {{ trackForm.get('title')?.value?.length || 0 }}/50 characters
                  </div>
                </div>

                <!-- Artist -->
                <div>
                  <label for="artist" class="block text-sm font-medium text-white mb-2">
                    Artist Name *
                  </label>
                  <input id="artist"
                         type="text"
                         formControlName="artist"
                         placeholder="Enter artist name"
                         class="input"
                         [class.border-red-500]="isFieldInvalid('artist')" />
                  <div *ngIf="isFieldInvalid('artist')" class="mt-2 text-sm text-red-600">
                    <span *ngIf="trackForm.get('artist')?.errors?.['required']">Artist is required</span>
                    <span *ngIf="trackForm.get('artist')?.errors?.['maxlength']">Artist cannot exceed 50 characters</span>
                  </div>
                </div>

                <!-- Description -->
                <div>
                  <label for="description" class="block text-sm font-medium text-white mb-2">
                    Description
                  </label>
                  <textarea id="description"
                            formControlName="description"
                            rows="4"
                            placeholder="Describe this track (optional)"
                            class="input resize-none"
                            maxlength="200"></textarea>
                  <div class="mt-1 text-xs text-gray-500 flex justify-between">
                    <span>Optional description</span>
                    <span>{{ trackForm.get('description')?.value?.length || 0 }}/200</span>
                  </div>
                </div>

                <!-- Category & Duration -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <label for="category" class="block text-sm font-medium text-white mb-2">
                      Category *
                    </label>
                    <select id="category"
                            formControlName="category"
                            class="input"
                            [class.border-red-500]="isFieldInvalid('category')">
                      <option value="">Select a category</option>
                      <option *ngFor="let category of categories" [value]="category">
                        {{ category }}
                      </option>
                    </select>
                    <div *ngIf="isFieldInvalid('category')" class="mt-2 text-sm text-red-600">
                      Please select a category
                    </div>
                  </div>

                  <div>
                    <label for="duration" class="block text-sm font-medium text-white mb-2">
                      Duration (seconds) *
                    </label>
                    <input id="duration"
                           type="number"
                           formControlName="duration"
                           placeholder="e.g., 180"
                           min="1"
                           class="input"
                           [class.border-red-500]="isFieldInvalid('duration')" />
                    <div *ngIf="isFieldInvalid('duration')" class="mt-2 text-sm text-red-600">
                      Duration must be at least 1 second
                    </div>
                    <div class="mt-1 text-xs text-gray-500">
                      {{ (trackForm.get('duration')?.value || 0) | duration }}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Media Files Card -->
            <div class="card">
              <h3 class="text-xl font-bold text-white pb-4 border-b border-gray-100">
                <i class="fas fa-file-upload text-white mr-2"></i>
                Media Files
              </h3>
              
              <div class="space-y-6">
                <!-- Audio File -->
                <div>
                  <label for="audioFile" class="block text-sm font-medium text-white mb-2">
                    Audio File *
                    <span class="text-gray-500 text-sm font-normal">(MP3, WAV, OGG - max 10MB)</span>
                  </label>
                  <div class="mt-2 flex items-center gap-4">
                    <label for="audioFile" class="cursor-pointer bg-white rounded-lg shadow-md">
                      <div class="btn btn-primary inline-flex items-center">
                        <i class="fas fa-music mr-2"></i>
                        {{ audioFile ? 'Change Audio File' : 'Choose Audio File' }}
                      </div>
                      <input id="audioFile"
                             type="file"
                             accept=".mp3,.wav,.ogg,audio/*"
                             (change)="onAudioFileSelected($event)"
                             class="hidden" />
                    </label>
                    
                    <div *ngIf="audioFile" class="text-sm">
                      <span class="text-green-600 font-medium">{{ audioFile.name }}</span>
                      <span class="text-gray-500 ml-2">
                        ({{ (audioFile.size / (1024 * 1024)).toFixed(2) }} MB)
                      </span>
                    </div>
                    
                    <!-- Current Audio File (Edit Mode) -->
                    <div *ngIf="isEditMode && currentTrack && currentTrack.audioUrl && !audioFile" class="text-sm">
                      <span class="text-gray-600">Current file:</span>
                      <a [href]="getFullAudioUrl()" 
                         target="_blank"
                         class="text-primary-600 hover:underline ml-2">
                        View/Download
                      </a>
                    </div>
                  </div>
                  
                  <div *ngIf="audioFileError" class="mt-2 text-sm text-red-600">
                    {{ audioFileError }}
                  </div>
                  
                  <div *ngIf="!audioFile && !isEditMode" class="mt-2 text-sm text-red-600">
                    Audio file is required for new tracks
                  </div>
                  
                  <!-- Audio Preview -->
                  <div *ngIf="audioFile || (isEditMode && currentTrack && currentTrack.audioUrl)" class="mt-4">
                    <audio controls class="w-full rounded-lg">
                      <source [src]="getAudioPreviewUrl()" type="audio/mpeg">
                      Your browser does not support the audio element.
                    </audio>
                  </div>
                </div>

                <!-- Cover File -->
                <div>
                  <label for="coverFile" class="block text-sm font-medium text-white mb-2">
                    Cover Image
                    <span class="text-gray-500 text-sm font-normal">(JPG, PNG, GIF, WebP - max 5MB)</span>
                  </label>
                  <div class="mt-2 flex items-center gap-4">
                    <label for="coverFile" class="cursor-pointer bg-white rounded-lg shadow-md">
                      <div class="btn btn-secondary inline-flex items-center">
                        <i class="fas fa-image mr-2"></i>
                        {{ coverFile ? 'Change Cover Image' : 'Choose Cover Image' }}
                      </div>
                      <input id="coverFile"
                             type="file"
                             accept=".jpg,.jpeg,.png,.gif,.webp,image/*"
                             (change)="onCoverFileSelected($event)"
                             class="hidden" />
                    </label>
                    
                    <div *ngIf="coverFile" class="text-sm">
                      <span class="text-green-600 font-medium">{{ coverFile.name }}</span>
                      <span class="text-gray-500 ml-2">
                        ({{ (coverFile.size / (1024 * 1024)).toFixed(2) }} MB)
                      </span>
                    </div>
                    
                    <!-- Current Cover Image (Edit Mode) -->
                    <div *ngIf="isEditMode && currentTrack && currentTrack.coverUrl && !coverFile" class="text-sm">
                      <span class="text-gray-600">Current image:</span>
                      <img [src]="getFullCoverUrl()" 
                           alt="Current cover"
                           class="h-8 w-8 object-cover rounded inline-block ml-2">
                    </div>
                  </div>
                  
                  <div *ngIf="coverFileError" class="mt-2 text-sm text-red-600">
                    {{ coverFileError }}
                  </div>
                  
                  <!-- Cover Preview -->
                  <div *ngIf="coverFile || (isEditMode && currentTrack && currentTrack.coverUrl)" class="mt-4">
                    <img [src]="getCoverPreviewUrl()"
                         alt="Cover preview"
                         class="h-48 w-48 object-cover rounded-lg shadow-md"
                         (error)="onCoverPreviewError($event)">
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Right Column: Preview & Actions -->
          <div class="space-y-8">
            <!-- Preview Card -->
            <div class="card bg-gradient-to-br from-primary-50 to-primary-100">
              <h3 class="text-lg font-bold text-white mb-4">Preview</h3>
              
              <div class="space-y-4">
                <!-- Cover Preview -->
                <div class="aspect-square rounded-lg overflow-hidden bg-gradient-to-br from-primary-200 to-primary-300">
                  <img [src]="getPreviewCoverUrl()"
                       [alt]="'Preview: ' + (trackForm.get('title')?.value || 'Untitled')"
                       class="w-full h-full object-cover"
                       (error)="onPreviewImageError($event)" />
                </div>

                <!-- Track Info Preview -->
                <div class="space-y-2">
                  <div class="font-bold text-lg text-white truncate">
                    {{ trackForm.get('title')?.value || 'Untitled Track' }}
                  </div>
                  <div class="text-sm text-white">
                    {{ trackForm.get('artist')?.value || 'Unknown Artist' }}
                  </div>
                  <div class="flex items-center justify-between text-sm">
                    <span class="badge bg-primary-200 text-primary-800">
                      {{ trackForm.get('category')?.value || 'Uncategorized' }}
                    </span>
                    <span class="text-gray-500">
                      {{ (trackForm.get('duration')?.value || 0) | duration }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Actions Card -->
            <div class="card">
              <h3 class="text-lg font-bold text-white mb-4">Actions</h3>
              
              <div class="space-y-4">
                <!-- Submit Button -->
<button type="submit"
        [disabled]="!canSubmit() || isSubmitting"
        class="w-full btn btn-primary py-3 text-lg">
  
  <span *ngIf="!isSubmitting" class="text-white bg-primary-200 px-4 py-2 rounded-lg">
    {{ isEditMode ? 'Update Track' : 'Add Track' }}
  </span>
  
  <span *ngIf="isSubmitting">
    <i class="fas fa-spinner fa-spin mr-2"></i>
    {{ isEditMode ? 'Updating...' : 'Adding...' }}
  </span>
</button>


                <!-- Cancel Button -->
                <a routerLink="/"
                   class="w-full btn btn-secondary py-3 text-lg inline-block text-center text-white">
                  <i class="fas fa-times mr-2"></i>
                  Cancel
                </a>

                <!-- Remove Current Audio Button (Edit Mode) -->
                <button *ngIf="isEditMode && currentTrack && currentTrack.audioUrl && !audioFile"
                        type="button"
                        (click)="removeCurrentAudio()"
                        class="w-full btn btn-danger py-3 text-lg text-white">
                  <i class="fas fa-trash mr-2 text-white"></i>
                  Remove Current Audio
                </button>

                <!-- Remove Current Cover Button (Edit Mode) -->
                <button *ngIf="isEditMode && currentTrack && currentTrack.coverUrl && !coverFile"
                        type="button"
                        (click)="removeCurrentCover()"
                        class="w-full btn btn-danger py-3 text-lg">
                  <i class="fas fa-trash mr-2"></i>
                  Remove Current Cover
                </button>

                <!-- Form Status -->
                <div *ngIf="submitError" 
                     class="p-3 bg-red-50 border border-red-200 rounded-lg">
                  <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-500 mr-2"></i>
                    <span class="text-red-700 text-sm">{{ submitError }}</span>
                  </div>
                </div>

                <div *ngIf="trackForm.valid && !isSubmitting && !submitError && (audioFile || isEditMode)"
                     class="p-3 bg-green-50 border border-green-200 rounded-lg">
                  <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    <span class="text-green-700 text-sm">Form is ready to submit</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Validation Summary -->
            <div class="card">
              <h3 class="text-lg font-bold text-white mb-4">Validation</h3>
              <div class="space-y-2">
                <div class="flex items-center text-sm"
                     [class.text-green-600]="trackForm.get('title')?.valid"
                     [class.text-red-600]="trackForm.get('title')?.invalid">
                  Title is {{ trackForm.get('title')?.valid ? 'valid' : 'invalid' }}
                </div>
                <div class="flex items-center text-sm"
                     [class.text-green-600]="trackForm.get('artist')?.valid"
                     [class.text-red-600]="trackForm.get('artist')?.invalid">
                  Artist is {{ trackForm.get('artist')?.valid ? 'valid' : 'invalid' }}
                </div>
                <div class="flex items-center text-sm"
                     [class.text-green-600]="audioFile || (isEditMode && currentTrack && currentTrack.audioUrl)"
                     [class.text-red-600]="!audioFile && !(isEditMode && currentTrack && currentTrack.audioUrl)">
                  Audio file is {{ (audioFile || (isEditMode && currentTrack && currentTrack.audioUrl)) ? 'provided' : 'required' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>